<!doctype html>
<html>
	<head>
		<title>AutoNote</title>
		<link rel="icon" href="webicon3.png">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
		<link rel="stylesheet" type="text/css" href="styles.css">
		<meta name="robots" content="nofollow" />

		<script type="text/javascript" src="animation-min.js"></script>
		<script type="text/javascript" src="index.js"></script>
		<script type="text/javascript" src="drawerutils.js"></script>
		<script type="text/javascript" src="drive/cal.js"></script>
		<script type="text/javascript" src="datacontroller.js"></script>
		<!--<script type="text/javascript" src="document.js"></script>-->
		<script type="text/javascript" src="anparser2.js"></script>
		<!--<script type="text/javascript" src="equation.min.js"></script>-->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/3.9.0/math.min.js"></script>
		
		<script src="https://www.gstatic.com/firebasejs/3.4.0/firebase.js"></script>
		<!--<script src="https://apis.google.com/js/platform.js" async defer></script>-->
		<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
		<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
<<<<<<< HEAD
		<script rel="stylesheet" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"></script>
=======
		<script type="text/javascript" src="https://apis.google.com/js/api.js?onload=onApiLoad"></script>
    <script src="https://apis.google.com/js/client:plusone.js" type="text/javascript"></script>
>>>>>>> 5d561df80832e5045a2ea46ad0999839883661d4



		
		<!-- <script src="https://apis.google.com/js/client.js?onload=hello"></script>
		
	    <meta name="google-signin-client_id" content="114533551990-7oplqe5lk60jk7vf4gs5ptqug2h2aoa6.apps.googleusercontent.com"> -->
	     <httpProtocol>

    <customHeaders>
      <!-- <add name="X-Frame-Options" value="DENY" /> -->
      <http-header name="Access-Control-Allow-Origin" value="https://lateral-scion-146706.appspot.com" />
      <http-header name="Origin" value="https://lateral-scion-146706.appspot.com" />

    </customHeaders>
  </httpProtocol>
	</head>	
	<body>


	<img id="loadingIcon" src="webicon.gif" style="width:44.57px;float:right;margin5px;margin-right:-50px;z-index:50;opacity:0;position:relative;">

		<div id="loginScreen" >
			<!-- <video  id="backgroundVideo" autoplay="autoplay" width="1000px">
			  <source src="background.mp4" type="video/mp4">
			</video> -->
			<!-- <img id="openBackground" class="smallImage" src="background720.png" style="width:100%;margin:-10px;"/> -->
			<img id="openBackground" class="largeImage" src="background.jpg" style="opacity:1;width:100%;margin:-10px;"/> 
			
			<div class="centeredBelow">
				
					<!-- -->
	            	<img id="welcomeLogo"  onload="slideIn(this, 1000)" src="logo_super_small7.png" alt="logo">
	            	<!-- <button class="ripple" >Login</button> -->
	            	<img id="googleSignIn" src="googleButton2.png" alt="logo">
	                <!-- <p id="googleSignIn">sign in with Google</p> -->
	            
	        </div>
	        
		</div>
		
		<div id="workScreen" style="opacity:0.00;">

			<div id="userCard">
				<p id="userEmail" style="font-size: 17px;color: #555555;font-family: arial;margin-top:17.5px;">asdfsdga</p>
				<p id="logout" style="font-size: 18px;color: #039bdf;font-family: arial;margin-top:-10px;display:none;">logout</p>
			</div>
			<!--<div id="iconSpacer">
				<img class="user" id="userIcon">

				<img class="settings" id="settingsIcon" src="settingsIcon.png">
				<img src="split.png" style="float:right;right:9.75%;margin:10px;z-index:9;position: absolute;width:30px;opacity: 0.875;">
			</div>-->
			<div id="settingsCard">
				<!-- <ul style="list-style-type: none;"> -->
					<p id="setting" class="color">change theme</p>
					<p id="setting" class="night">night mode</p>
					<p id="setting" class="help">help</p>
				
				<!-- <p id="setting1" class="color" style="font-size: 18px;color: #039bdf;font-family: arial;margin-top:12px;cursor:pointer;">change theme</p> -->
				<!-- <img id="colorIcon" class="color" src="ic_bubble_chart_white_48dp_1x.png" alt="theme"> -->
			</div>

			<div id='side'></div>

			<!-- <div class="actions">
	    		<img id="icon" class="color" src="ic_bubble_chart_white_48dp_1x.png" alt="vertical layout">
	    		<img id="icon" class="storage" onclick="deleteStorage()" src="ic_storage_white_48dp_1x.png" alt="vertical layout">
	    		<img class="atop" id="icon" src="ic_to_horizontal_layout.png" alt="vertical layout">
	    		<img class="abottom" id="icon" src="ic_to_vertical_layout.png" alt="drawer">
		    </div> -->
		    <p class="user" id="username"></p>



	      	<div id="header">

				<div id="cf2">
					<img class="top" id="drawer_button" src="ic_menu_white_48dp_1x.png" alt="drawer" style="cursor:pointer;width:40px;height:40px;opacity:1;z-index:9;">
					<img class="bottom" id="drawer_button" src="ic_arrow_back_white_48dp_1x.png" alt="drawer" style="cursor:pointer;width:40px;height:40px;opacity:0;z-index:0;">
				</div>
				<div class = "container-fluid">
					<div id="userIconSpacer">
						<img class="user" id="userIcon">
					</div>
						<img class="settings" id="settingsIcon" src="settingsIcon.png">
						<img src="split.png" style="float:right;right:9.75%;margin:10px;z-index:9;position: absolute;width:30px;opacity: 0.875;">
					</div>
				</div>
				<a href="https://myautonote.com">
					<div id="cflogo" class="shadow">
						<img id="logo" src="logo_super_small7.png" alt="logo">
					</div>
				</a>

				</div>

	      	<!-- <table style="width:75%;margin-left:12.5%;margin-top:5%;">
	      		<tr>
	      			<td><div class="folderCard" style="height:150px;line-height:150px;width:250px"><div id="folderTitle">CS 233</div></div></td>
	      			<td><div class="folderCard" style="height:150px;line-height:150px;width:250px"><div id="folderTitle">CS 410</div></div></td>
	      			<td><div class="folderCard" style="height:150px;line-height:150px;width:250px"><div id="folderTitle">Math 415</div></div></td>
	      		</tr>
	      		<tr>
	      			<td><div class="folderCard" style="height:150px;line-height:150px;width:250px"><div id="folderTitle">CS 233</div></div></td>
	      			<td><div class="folderCard" style="height:150px;line-height:150px;width:250px"><div id="folderTitle">CS 410</div></div></td>
	      			<td><div class="folderCard" style="height:150px;line-height:150px;width:250px"><div id="folderTitle">Math 415</div></div></td>
	      		</tr>
	      	</table> -->
	      	

	      	

	      		<div id="left" style="display:none;">
					<div id="toolbar1">
						<p onclick="changeTitle(this)" style="margin-top:5px;">Sample Note</p>
						<!-- <table style="width:100%;"><tr><td><p onclick="changeTitle(this)">Sample Note</p></td>
							<td style="text-align:right;"><img style="margin-right:50px" id="toolbaricon" class="bulletPoint" src="bulletpoint.png" alt="bullet point" title="underline"></td>
							
						</tr></table> --> </div>
					<textarea id="document" rows="15" autofocus="true"></textarea>
				</div>


				
				<div id="right" style="display:none;">
					<div id="toolbar2">
						<!-- <img id="toolbaricon" class="highlight" src="highlight.png" alt="highlight" title="highlight">
						
						<img id="toolbaricon" class="arrow" src="arrow.png" alt="arrow" title="arrow"> -->
						<img id="toolbaricon" class="underline" onclick="createPicker()" src="underline.png" alt="underline" title="underline">
						<img id="toolbaricon" class="underline" src="split.png">
						<img id="toolbaricon" class="web" src="ic_public_black_48dp_1x.png" alt="webview" title="open webview">
						<img id="toolbaricon" class="smartclick" src="ic_flash_off_black_48dp_1x.png" alt="smart click" title="smart click">
						<!-- <img id="toolbaricon" class="classnet" src="coursenet.png" alt="compare to class" title="compare to class"> -->
						<img id="toolbaricon" class="download" onclick="downloadNote()" src="download.png" alt="download" title="download">
						<!-- <a href="download.png" download="download">
						<img id="toolbaricon" class="download" src="download.png" alt="download note" title="download note"></a> -->
						<img id="toolbaricon" class="fullscreen" style="margin-left:50px;" src="ic_fullscreen_black_48dp_2x.png" alt="fullscreen" title="fullscreen">


					</div>

					<div id="tabs">
						
							<img id="tabLeft" onclick="tabLeftClicked()" src="leftarrow.png" draggable="false">
							<img id="tabDrag"src="drag.png">
							<img id="tabRight" onclick="tabRightClicked()" src="rightarrow.png" draggable="false">
						
						
						<!-- <table>
							<tr><td><img id="tabLeft" onclick="tabLeftClicked()" src="leftarrow.png" draggable="false"></td>
							
							<td><img id="tabRight" onclick="tabRightClicked()" src="rightarrow.png" draggable="false"></td>
							<tr><td><img id="tabDrag"src="drag.png"></td></tr>
						</table> -->
					</div>
					
					<!-- <canvas id="myCanvas"></canvas> -->
					<div id="outbox" class="isResizable" contenteditable="false"></div>

					
					<div id="webview">
						
						<iframe id="iframe" style="width:100%; height:100%;" 
							frameborder="0"
						    marginheight="0"
						    marginwidth="0"
						    onerror="alert('failed to load');"
						    onload="iframeIsLoaded(this);"
						    iframeFailed="iframeFailed('failed function');"
					    ></iframe>
					</div>
				</div>
				
				<!-- <form id="file-form" action="handler.php" method="POST" enctype="multipart/form-data">
				  <input type="file" id="file-select" name="photos[]" multiple/>
				  <button type="submit" id="upload-button">Upload</button>
				</form> -->
				<div id="closeArea" style="width:100%;height:1000px;position:absolute;background:#aaaaff;z-index:11;opacity:0;display:none;"></div>
				<div id='openNote' style="width:100%;text-align:center;margin-top:20%;">
			      	<h2 class="startMessage" id='continueMessage' onclick="loadLastNote()">continue working on (abcdef)</h2>
			      	
			      	
			      	<h2 class="startMessage" id='predictNewMessage' onclick="createPicker()">open a note from google drive</h2>
			      	
			      	</div>
				</div>


<!-- <div id="infoScreen" style="width:100%;height:500px;background:#ff0000;">hello</div> -->

				<script src="https://www.gstatic.com/firebasejs/3.4.0/firebase.js"></script>
			<script>

			/*var userInput = "hello";
			$('#openNote').append("<div class=\"g-savetodrive\""+
				         "data-src=\"drive/blankdrivefile2\""+
				         "data-filename=\""+userInput+"\""+
				         "data-sitename=\"myAutoNote\">"+
				    "</div>");*/


			var queue = [];

			function push(f, n){//TODO add line by line functionality
				for(var i = 0 ; i < queue.length; i++){
					if(queue[i].f == f && queue[i].n == n){
						//console.log(queue);
						return;
					}
				}
				queue.push({f:f, n:n});
				saveSecure("queue", JSON.stringify(queue));

				//console.log(queue);
			}

			var activeNoteProgress = 0;
			var mainNoteForHour;
			function dumpQueue(state){

				if(state == 1)
					startLoad(0);
				if(queue.length == 1){
					if(state == 0){
						if(mainNoteForHour == queue[0]){
							activeNoteProgress++;
							for(var i = 0; i < schedule[day].length; i++){
								if(schedule[day][i] == hour){
									if(schedule[day][i].count < activeNoteProgress){
										schedule[day][i].count = activeNoteProgress;
										
									}
									console.log("MATCHED PREDICTION!!!");
								}
							}
							//if(schedule[d.getHours()] activeNoteProgress >= 3 ||){}
						}
					}
					var cn = queue[0].f + "," + queue[0].n;
					if(cn != backedUpLastNote){
						updateUser(queue[0].f + "," + queue[0].n);

					}
				}
				for(var i = 0 ; i < queue.length; i++){
					console.log(queue[i].f + " : " + queue[i].n + " : ");
					//console.log(fs_folders[queue[i].f].node.notes.edges[parseInt(queue[i].n)].node.content);
					console.log(fs_folders[queue[i].f].node.notes.edges[parseInt(queue[i].n)].node.content.replace(/\n/g, "0x0A"));
					updateNoteContent(fs_folders[queue[i].f].node.notes.edges[parseInt(queue[i].n)].node.id, fs_folders[queue[i].f].node.notes.edges[parseInt(queue[i].n)].node.content.replace(/\n/g, "0x0A"));
				}
				saveSecure("queue", "[]");
				queue = [];
				if(state == 1){
					console.log("closing")
					this.window.close();
					finishLoad();
				}
				
			}

			var timer = setInterval(function(){
				dumpQueue(0);
				console.log("saving");
			}, 120000);

			var activeUser = "";
			var config = {
			    apiKey: "AIzaSyBLtadLS0UpmV8rlQ8Bz7pOcPy8avTbTr4",
			    authDomain: "myautonote-145fd.firebaseapp.com",
			    databaseURL: "https://myautonote-145fd.firebaseio.com",
			    storageBucket: "myautonote-145fd.appspot.com",
			    messagingSenderId: "1020202946130"
			  };
			firebase.initializeApp(config);

			const btnLogOut = document.getElementById('logout');
			btnLogOut.addEventListener('click', e => {
				dumpQueue();

				activeUser = "";
				localStorage.clear();
				startLoad(0);
				firebase.auth().signOut();
				hideUserCard();
				slideIn($('#welcomeLogo'),1000);
				$( "#loginScreen" ).fadeTo( "slow" , 1, function() { finishLoad()});
				$( "#workScreen" ).fadeOut( "slow", function() {});
				if($(window).width() > $(window).height()){
					$('#openBackground').height(($(window).height()+50)+'px');
					$('#openBackground').width(($('#openBackground').height()/0.5625+150)+'px');
					console.log("landcape");

				}else{
					$('#openBackground').width(($(window).width()+150)+'px');
					$('#openBackground').height(($('#openBackground').width()/0.5625+50)+'px');
					console.log("portfolio");
				}

			});

			function signIn(){
				const auth = firebase.auth();
				
				var provider = new firebase.auth.GoogleAuthProvider();
				firebase.auth().signInWithPopup(provider).then(function(result) {
				  // This gives you a Google Access Token. You can use it to access the Google API.
				  console.log("complete");
				  var token = result.credential.accessToken;
				  console.log("succesfull Log in");
				  console.log(token);

				  // The signed-in user info.
				  //pull("");
				  
				}).catch(function(error) {
				  // Handle Errors here.

				  finishLoad();
				  const promise = auth.signInWithEmailAndPassword("user8@mail.com", "user123");
				  promise.catch(e => reset(e.message));
				  
				});
			}	

			function reset(message){
				if(message.includes("no user record")){
					firebase.auth().createUserWithEmailAndPassword("user8@mail.com", "user123").catch(function(error) {
					  // Handle Errors here.
					  var errorCode = error.code;
					  var errorMessage = error.message;
					  alert(error);
					});
				}else
					alert(message);
			}

			firebase.auth().onAuthStateChanged(firebaseUser => {
				activeUser = firebaseUser;
				console.log(firebaseUser);
				if(firebaseUser){

					finishLoad();

					slideOut($('#welcomeLogo'),1000);
					$('#openBackground').width(($(window).width())+'px');
					$('#openBackground').css('margin-left', 0+'px');
					$( "#loginScreen" ).fadeOut( "slow", function() {});
					$( "#workScreen" ).fadeTo( "slow" , 1, function() { });
					if(activeUser.displayName != null){
						$('#username').text(activeUser.displayName.split(" ")[0]);
					}else{
						$('#username').text(activeUser.email);
					}

					if(activeUser.photoURL != null){
						$('#userIcon').attr('src', activeUser.photoURL);
					}else{
						$('#userIcon').attr('src', 'blankaccount.png');
					}
						$('#userEmail').text(activeUser.email);

					//TODO
					//Decide if new user
					
					var userId = firebase.auth().currentUser.uid;
					/*firebase.database().ref('users/' + userId).once('value').then(function(snapshot) {
						
						console.log(snapshot.val());
						//printValues(snapshot.val());
						if(snapshot.val()){
							console.log("exists");
							firebase.database().ref('users/' + userId + '/Documents').set({
								note_2 : "sample text for your second note"
							});
						}else{
							console.log("new user");
							firebase.database().ref('users/' + userId + '/Documents').set({
								Welcome_to_myAutoNote : "Capital Letters Indicate Titles\nA dash at the end of a line will make a header-\nContent under headers will shift over\n--make italics with two dashes before and after a line--\n--shift content back over by putting a dash on an empty line--\nIf you dont use any dashes then just a plain line will appear\n-A dash at the beginning of a line makes bullet points\n-Make as many as you want\nclick links with smart click turned on to view a mini webview\nhttps://chara.cs.illinois.edu/cs225/"
							});
						}
					});*/

					
					//get folder titles
					fs_folders = JSON.parse(getSecure("usersfolders"));
					lastNote = getSecure("lastNote");
					userDBID = getSecure("usersDBID");

					console.log(getSecure("usersfolders"));
					console.log(JSON.parse(getSecure("usersfolders")));
					if(typeof fs_folders == 'undefined' || fs_folders == null){
						startLoad(0);
						loginUserAndGetFolders();

					}else{
						console.log("from cache");
						console.log(fs_folders);
						noteDrawerClick();
						$('#closeArea').css('display', 'none');

						if(lastNote == null || lastNote == ''){
							lastNote = [0,0];
						}else
							lastNote = lastNote.split(",");
						$('#continueMessage').text("continue working on (" + fs_folders[parseInt(lastNote[0])].node.notes.edges[parseInt(lastNote[1])].node.Title + ")");
						
						schedule = JSON.parse(getSecure("usersSchedule"));

					}
					queue = JSON.parse(getSecure("queue"));
					
					if(queue == null)
						queue = [];
					

					getRecomendation();
				}
			})

		function getRecomendation(){
			var d = new Date();
			day = d.getDay();
			hour = d.getHours();
			console.log(day + ", " + hours);
			console.log(schedule);
			if(schedule.length > 0){
				if(schedule[day].length > 0){
					for(var i = 0; i < schedule[day].length; i++){
						if(schedule[day][i] == hour){
							console.log("MATCHED PREDICTION!!!");
						}
					}
				}
			}
		}

		/*function createUser(){
				//console.log(activeUser);
				var email = activeUser.email;
				var uid = activeUser.uid;
				var data = {"query": `mutation CreateUser($input: CreateUserInput!) {
							  createUser(input: $input) {
							    changedUser {
							      id
							    }
							  }
							}`,
					"variables": `{
				    "input": {
				      "username": "${email}",
				      "password": "${uid}"
				    }}`	
			 	 }	

				$.ajax({
				  type: "POST",
				  url: "https://us-west-2.api.scaphold.io/graphql/myautonotedev"+"?query="+data.query.replace(/\t/g,'').replace(/\n/g,'')+"&variables="+data.variables.replace(/\t/g,'').replace(/\n/g,''),
				  
				  json: true,
				  success: function(response, status) {
				        console.log(status);
				        console.log(response);
						console.log("from database");
						finishLoad();
				        fs_folders = [];
						schedule = [[],[],[],[],[],[],[]];

						userDBID = response.data.createUser.changedUser.id;
				        saveSecure("usersfolders", JSON.stringify(fs_folders));
				        saveSecure("usersDBID", userDBID);
				        console.log(fs_folders);

				        addFolder('Documents', 1);
				        noteDrawerClick();


				    },
				});
			}*/

			/*function loginUserAndGetFolders(){
				//console.log(activeUser);
				var email = activeUser.email;
				var uid = activeUser.uid;
				var data = {"query": `mutation LoginUserQuery ($input: LoginUserInput!) {
					    loginUser(input: $input) {
						    user {
						    	id
						    	lastNote
						    	schedule
						      folders {
						        edges {
						          node {
						            Title
						            id
						            notes {
						              edges {
						                node {
						                  Title
						                  id
						                }
						              }
						            }
						          }
						        }
						      }
						    }
						  }
					}`,
					"variables": `{
				    "input": {
				      "username": "${email}",
				      "password": "${uid}"
				    }}`	
			 	 }	

				$.ajax({
				  type: "POST",
				  url: "https://us-west-2.api.scaphold.io/graphql/myautonotedev"+"?query="+data.query.replace(/\t/g,'').replace(/\n/g,'')+"&variables="+data.variables.replace(/\t/g,'').replace(/\n/g,''),
				  
				  json: true,
				  success: function(response, status) {
				        console.log(status);
				        console.log(response);
						console.log("from database");
						if(response.data.loginUser == null){
						//if(typeof response.error != 'undefined' || response.error != null){
							createUser();
						}else{
							finishLoad();
					        fs_folders = convertQueuesToStack(response.data.loginUser.user.folders.edges);
							userDBID = response.data.loginUser.user.id;
							lastNote = response.data.loginUser.user.lastNote;
							schedule = JSON.parse(response.data.loginUser.user.schedule);
							if(lastNote == null || lastNote == ''){
								lastNote = [0,0];
							}else
								lastNote = lastNote.split(",");
							backedUpLastNote = lastNote;
					        saveSecure("usersfolders", JSON.stringify(fs_folders));
					        saveSecure("usersSchedule", JSON.stringify(schedule));
					        saveSecure("usersDBID", userDBID);
					        console.log(fs_folders);
					        noteDrawerClick();
							$('#closeArea').css('display', 'none');
							$('#continueMessage').text("continue working on (" + fs_folders[parseInt(lastNote[0])].node.notes.edges[parseInt(lastNote[1])].node.Title + ")");

					    }
				    },
				});
			}*/

			function updateUser(ln){
				var data = {"query": `mutation UpdateUser($input: UpdateUserInput!) {
										  updateUser(input: $input) {
										    changedUser {
										      id
										    }}}`,
						"variables": `{
								    "input": {
								      "id": "${userDBID}",
								      "lastNote": "${ln}"
								      
								    }}`	}	

				$.ajax({
				  type: "POST",
				  url: "https://us-west-2.api.scaphold.io/graphql/myautonotedev"+"?query="+data.query.replace(/\t/g,'').replace(/\n/g,'')+"&variables="+data.variables.replace(/\t/g,'').replace(/\n/g,''),
				  
				  json: true,
				  /*data: data,*/
				  success: function(response, status) {
				        console.log(status);
				        console.log(response);
						console.log("from database");
						backedUpLastNote = lastNote;
				    },
				});
			}

			function convertQueuesToStack(data){
				var out = [];
				for(var i = 0; i < data.length; i++){
					var a = data[i];
					a.node.notes.edges.reverse();
					out.push(a);
				}
				return out;
			}

			function addFolder(title, state){
				startLoad(0);
				var data = {"query": `mutation UpdateUser($input: CreateFolderInput!) {
										  createFolder(input: $input) {
										    changedFolder {
											      Title
											      id
											      notes {
											        edges {
											          node {
											            Title
											            id
											          }
											        }
											      }
											    }
										  }
										}`,
						"variables": `{
								    "input": {
								      "userId": "${userDBID}",
								      "Title": "${title}"
								      
								    }}`	}	

				$.ajax({
				  type: "POST",
				  url: "https://us-west-2.api.scaphold.io/graphql/myautonotedev"+"?query="+data.query.replace(/\t/g,'').replace(/\n/g,'')+"&variables="+data.variables.replace(/\t/g,'').replace(/\n/g,''),
				  
				  json: true,
				  /*data: data,*/
				  success: function(response, status) {
				        console.log(status);
				        console.log(response);
						console.log("from database");
						finishLoad();
						var node = {node: response.data.createFolder.changedFolder}
						//fs_folders.push(node);
						fs_folders.unshift(node);

						//folderTitles.push(title.replace(/ /g, "_"));
							
				        saveSecure("usersfolders", JSON.stringify(fs_folders));
				        console.log("fs_folders", fs_folders);
				        
				        if(state == 1){
				        	addNoteToDB(0, "Welcome To myAutoNote", "How to prepare a peanut butter and jelly sandwich?`\nPreparation\n`Pull two slices of bread out of the package\n`Lay the slices down adjacent to each other \n`Get the peanut butter and jelly out of the fridge\n`Open both jars\n`Take a knife out of your utensil drawer\nAssembly\n`Jelly``\n``Scoop up a small mound of jelly from the jelly jar\n``Scrape the mound onto the left-most slice of bread and spread it around evenly\n`Peanut Putter``\n``Scoop up a small mound of peanut putter from the peanut butter jar\n``Scrape the mound onto the right-most slice of bread and spread it around evenly\n`Bread``\n``Carefully pick up one slice of bread only holding the sides\n``Flip it over and place it onto the other slice\nClean Up\n`Clean up your work surface by screwing the lids back onto the jars and washing the knife\nNow you can eat your sandwich!!!`\nVocabulary\nUtensil- an implement, container, or other article, especially for household use.\nSlice-a small cross-section of bread");
				        }

				        var folderTitles = [];
						for(var f = 0; f < fs_folders.length; f++){
							folderTitles.push(fs_folders[f].node.Title.replace(/ /g, "_"));
						}
						createFolderCards(folderTitles);
				        //console.log(folderTitles);
				    },
				});
			}

			function updateFolder(folderID, folderTitle){
				var data = {"query": `mutation UpdateFolder($input: UpdateFolderInput!) {
										  updateFolder(input: $input) {
										    changedFolder {
										      id
										    }}}`,
						"variables": `{
								    "input": {
								      "id": "${folderID}",
								      "Title": "${folderTitle}"
								      
								    }}`	}	

				$.ajax({
				  type: "POST",
				  url: "https://us-west-2.api.scaphold.io/graphql/myautonotedev"+"?query="+data.query.replace(/\t/g,'').replace(/\n/g,'')+"&variables="+data.variables.replace(/\t/g,'').replace(/\n/g,''),
				  json: true,
				  data: data,
				  success: function(response, status) {
				        console.log(status);
				        console.log(response);
						console.log("from database");
				    },
				});
			}

			function updateFolderTimes(folderID, folderTimes){
				var data = {"query": `mutation UpdateFolder($input: UpdateFolderInput!) {
										  updateFolder(input: $input) {
										    changedFolder {
										      id
										    }}}`,
						"variables": `{
								    "input": {
								      "id": "${folderID}",
								      "time": "${folderTimes}"
								      
								    }}`	}	

				$.ajax({
				  type: "POST",
				  url: "https://us-west-2.api.scaphold.io/graphql/myautonotedev"+"?query="+data.query.replace(/\t/g,'').replace(/\n/g,'')+"&variables="+data.variables.replace(/\t/g,'').replace(/\n/g,''),
				  
				  json: true,
				  /*data: data,*/
				  success: function(response, status) {
				        console.log(status);
				        console.log(response);
						console.log("from database");
				    },
				});
			}

			function updateNoteTitle(noteID, noteTitle){
				var data = {"query": `mutation UpdateNote($input: UpdateNoteInput!) {
										  updateNote(input: $input) {
										    changedNote {
										      id
										    }}}`,
							"variables": `{
								    "input": {
								      "id": "${noteID}",
								      "Title": "${noteTitle}"
								      
								    }}`	}	

				$.ajax({
				  type: "POST",
				  url: "https://us-west-2.api.scaphold.io/graphql/myautonotedev"+"?query="+data.query.replace(/\t/g,'').replace(/\n/g,'')+"&variables="+data.variables.replace(/\t/g,'').replace(/\n/g,''),
				  
				  json: true,
				  /*data: data,*/
				  success: function(response, status) {
				        console.log(status);
				        console.log(response);
						console.log("from database");
				    },
				});
			}

			function updateNoteContent(noteID, noteContent){
				var data = {"query": `mutation UpdateNote($input: UpdateNoteInput!) {
										  updateNote(input: $input) {
										    changedNote {
										      id
										    }}}`,
							"variables": `{
								    "input": {
								      "id": "${noteID}",
								      "content": "${noteContent}"
								      
								    }}`	}	

				$.ajax({
				  type: "POST",
				  url: "https://us-west-2.api.scaphold.io/graphql/myautonotedev"+"?query="+data.query.replace(/\t/g,'').replace(/\n/g,'')+"&variables="+data.variables.replace(/\t/g,'').replace(/\n/g,''),
				  json: true,
				  /*data: data,*/
				  success: function(response, status) {
				        console.log(status);
				        console.log(response);
						console.log("from database");
				    },
				});
			}

			function addNoteToDB(folderIndex, title, stuff){
				var folderID = fs_folders[folderIndex].node.id;
				var data = {"query": `mutation CreatNote($input: CreateNoteInput!) {
										  createNote(input: $input) {
										    changedNote {
										      id
										    }
										  }
										}
										`,
						"variables": `{
					          "input": {
					            "folderId": "${folderID}",
					            "Title": "${title}",
					            "content": "${stuff}"

					          }}`	}	

				$.ajax({
				  type: "POST",
				  url: "https://us-west-2.api.scaphold.io/graphql/myautonotedev"+"?query="+data.query.replace(/\t/g,'').replace(/\n/g,'')+"&variables="+data.variables.replace(/\t/g,'').replace(/\n/g,''),
				  json: true,
				  data: data,
				  success: function(response, status) {
				        console.log(status);
				        console.log(response);
				        console.log(response.data.createNote.changedNote);
						console.log("from database");

						var node = {node: response.data.createNote.changedNote}
						node.node.Title = title;
						fs_folders[folderIndex].node.notes.edges.push(node);
						//folderTitles.push(title.replace(/ /g, "_"));
							
				        saveSecure("usersfolders", JSON.stringify(fs_folders));
				        
				        //console.log(folderTitles);
				    }
				});
			}

			function printValues(object){
				for (var key in object) {
					if(typeof object[key] == 'object'){
						console.log(key + "->");
						printValues(object[key]);
					}else
					  console.log(key, object[key]);
					  console.log("");
				}
			}

			/*function push(location, key, val){
				var userId = firebase.auth().currentUser.uid;
				firebase.database().ref('users/' + userId + '/' + location).set({
					key : val
				});
			}

			function pull(location){
				var userId = firebase.auth().currentUser.uid;
				firebase.database().ref('users/' + userId + location).once('value').then(function(snapshot) {
					console.log(snapshot.val());
					return snapshot.val();
				});
			}*/

			</script>
			<script type="text/javascript">

			var CLIENT_ID = '1020202946130-7ojreg61fatq020ccnhgnal0gu8l2ls8.apps.googleusercontent.com';

			  // Array of API discovery doc URLs for APIs used by the quickstart
			  var DISCOVERY_DOCS = ["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"];

			  // Authorization scopes required by the API; multiple scopes can be
			  // included, separated by spaces.
			  var SCOPES = 'https://www.googleapis.com/auth/drive.metadata.readonly';

			  /*var authorizeButton = document.getElementById('authorize-button');
			  var signoutButton = document.getElementById('signout-button');*/

			  /**
			   *  On load, called to load the auth2 library and API client library.
			   */
			  function handleClientLoad() {
			    gapi.load('client:auth2', initClient);
			  }

			  /**
			   *  Initializes the API client library and sets up sign-in state
			   *  listeners.
			   */
			  function initClient() {
			    gapi.client.init({
			      discoveryDocs: DISCOVERY_DOCS,
			      clientId: CLIENT_ID,
			      scope: SCOPES
			    }).then(function () {
			      // Listen for sign-in state changes.
			      gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);

			      // Handle the initial sign-in state.
			      updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
			      //authorizeButton.onclick = handleAuthClick;
			      //signoutButton.onclick = handleSignoutClick;
			    });
			  }

			  /**
			   *  Called when the signed in status changes, to update the UI
			   *  appropriately. After a sign-in, the API is called.
			   */
			  function updateSigninStatus(isSignedIn) {
			    /*if (isSignedIn) {
			      authorizeButton.style.display = 'none';
			      signoutButton.style.display = 'block';
			      listFiles();
			    } else {
			      authorizeButton.style.display = 'block';
			      signoutButton.style.display = 'none';
			    }*/
			  }

			  /**
			   *  Sign in the user upon button click.
			   */
			  function handleAuthClick(event) {
			    gapi.auth2.getAuthInstance().signIn();
			  }

			  /**
			   *  Sign out the user upon button click.
			   */
			  function handleSignoutClick(event) {
			    gapi.auth2.getAuthInstance().signOut();
			  }

			  /**
			   * Append a pre element to the body containing the given message
			   * as its text node. Used to display the results of the API call.
			   *
			   * @param {string} message Text to be placed in pre element.
			   */
			  function appendPre(message) {
			    //var pre = document.getElementById('content');
			    //1var textContent = document.createTextNode(message + '\n');
			    console.log(message);
			    //pre.appendChild(textContent);
			  }

			  /**
			   * Print files.
			   */
			  function listFiles() {
			    gapi.client.drive.files.list({
			      'pageSize': 10,
			      'fields': "nextPageToken, files(id, name)"
			    }).then(function(response) {
			      appendPre('Files:');
			      var files = response.result.files;
			      if (files && files.length > 0) {
			        for (var i = 0; i < files.length; i++) {
			          var file = files[i];
			          appendPre(file.name + ' (' + file.id + ')');
			        }
			      } else {
			        appendPre('No files found.');
			      }
			    });
			  }

			  // The Browser API key obtained from the Google Developers Console.
			  var developerKey = 'AIzaSyBLtadLS0UpmV8rlQ8Bz7pOcPy8avTbTr4';

			  // The Client ID obtained from the Google Developers Console. Replace with your own Client ID.
			  var clientId = "1020202946130-7ojreg61fatq020ccnhgnal0gu8l2ls8.apps.googleusercontent.com";

			  // Scope to use to access user's photos.
			  var scope = ['https://www.googleapis.com/auth/drive.file'];

			  var pickerApiLoaded = false;
			  var oauthToken;

			  // Use the API Loader script to load google.picker and gapi.auth.
			  function onApiLoad() {
			    gapi.load('auth', {'callback': onAuthApiLoad});
			    gapi.load('picker', {'callback': onPickerApiLoad});
			  }

			  function onAuthApiLoad() {
			    window.gapi.auth.authorize(
			        {
			          'client_id': clientId,
			          'scope': scope,
			          'immediate': false
			        },
			        handleAuthResult);
			  }

			  function onPickerApiLoad() {
			    pickerApiLoaded = true;
			    createPicker();
			  }

			  function handleAuthResult(authResult) {
			    if (authResult && !authResult.error) {
			      oauthToken = authResult.access_token;
			      //createPicker();
			    }
			  }

			  // Create and render a Picker object for picking user Photos.
			  function createPicker() {
			    if (pickerApiLoaded && oauthToken) {
			      var picker = new google.picker.PickerBuilder().
			          addView(google.picker.ViewId.DOCS).
			          setOAuthToken(oauthToken).
			          setDeveloperKey(developerKey).
			          setCallback(pickerCallback).
			          setOrigin('https://myautonote-145fd.firebaseapp.com').
			          build();
			      picker.setVisible(true);
			    }
			  }

			  // A simple callback implementation.
			  function pickerCallback(data) {

	        var url = 'nothing';
	        if (data[google.picker.Response.ACTION] == google.picker.Action.PICKED) {
	        	/*startLoad(0);
		  		finishLoad();*/

				var doc = data[google.picker.Response.DOCUMENTS][0];
				url = doc[google.picker.Document.URL];
				console.log(data);
				console.log(data.docs[0].id);


				//TODO
				//window.gapi.client.drive.files.update({fileId:data.docs[0].id, uploadType:"media", description:document.getElementById("document").value}).execute();


				var content = data.docs[0].description;
		        console.log(content);
				//fs_folders[f].node.notes.edges[parseInt(id)].node.content = content;
				$('#toolbar1 p').text(data.docs[0]name);
		        document.getElementById("document").value = content;
		        activeFolder = f;
		        activeNote = id;
		        makeDocFromKey();
		        $('#left').css("display", "block");
   				$('#right').css("display", "block");
   				lastLine = 0;
			}


	          //0B_khEWHI3aMLeDd4dnJ0dVpxVlU
	          //AIzaSyC-HG-BAHdaINs5flrVMDeY8IxtJgiwtmQ

	        function gd_updateFile(fileId, folderId, text, callback) {

	          const boundary = '-------314159265358979323846';
	          const delimiter = "\r\n--" + boundary + "\r\n";
	          const close_delim = "\r\n--" + boundary + "--";

	          var contentType = "text/html";
	          var metadata = {'mimeType': contentType,};

	          var multipartRequestBody =
	              delimiter +  'Content-Type: application/json\r\n\r\n' +
	              JSON.stringify(metadata) +
	              delimiter + 'Content-Type: ' + contentType + '\r\n' + '\r\n' +
	              text +
	              close_delim;

	          if (!callback) { callback = function(file) { console.log("Update Complete ",file) }; }

	          gapi.client.request({
	              'path': '/upload/drive/v2/files/'+folderId+"?fileId="+fileId+"&uploadType=multipart",
	              'method': 'PUT',
	              'params': {'fileId': fileId, 'uploadType': 'multipart'},
	              'headers': {'Content-Type': 'multipart/mixed; boundary="' + boundary + '"'},
	              'body': multipartRequestBody,
	              callback:callback,
	          });
	        }

       
    </script>
    <script type="text/javascript" src="https://apis.google.com/js/api.js?onload=onApiLoad"></script>
    <script async defer src="https://apis.google.com/js/api.js"
        onload="this.onload=function(){};handleClientLoad()"
        onreadystatechange="if (this.readyState === 'complete') this.onload()">
    </script>
		</body>
</html>